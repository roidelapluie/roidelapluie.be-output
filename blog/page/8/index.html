<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="Hugo 0.25.1" />

        <title>Blogs - Julien Pivotto</title>
    </head>
    <body class="bg-faded">
        <div class="bg-primary"><nav class="navbar navbar-toggleable-md navbar-inverse bg-primary container">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-brand mb-0">roidelapluie</div>
        
        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav mr-auto">
                
                
                <a class="nav-item nav-link " href="/">
                        About me
                    </a>
                
                
                
                <a class="nav-item nav-link  active" href="/blog/">
                        Blogs
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/exherbo/">
                        Exherbo
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/logbook/">
                        Logbooks
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/skill/">
                        Skills
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/talk/">
                        Talks
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/wiki/">
                        Wikis
                    </a>
                
                
            </div>
            <div class="navbar-nav">
                
                
                    
                    
                        
                            
                        
                    
                    <a class="nav-item nav-link  active" href="/en">
                        en
                    </a>
                
                
                    
                    
                        
                            
                                
                            
                        
                    
                    <a class="nav-item nav-link " href="https://roidelapluie.be/fr/blog/">
                        fr
                    </a>
                
            </div>
        </div>
</nav>
</div>

        <div style="background-color:white">
        <div class="container pt-3 pb-3">

    
        <h1 class="title mt-3 mb-3"><a href="/blog/2015/04/15/xtrabackup-and-mariadb/" class="text-gray-dark">
    Percona XtraBackup 2.2.10 is incompatible with MariaDB 10.0
</a></h1>
<div class="content text-justify">
    

<p><a href="http://www.percona.com/doc/percona-xtrabackup/2.2/">Percona XtraBackup</a> is
probably the most relevant open-source backup solution for both
<a href="http://www.mysql.com/">MySQL</a> and <a href="https://mariadb.org/">MariaDB</a>. It has all
the required features that you need to backup your database, especially if you use innodb (or xtradb).</p>

<p>One of the features are Incremental backups. It is an easy way to get
a consistent backup of your databases in a short amount of time.</p>

<p>But the latest version of XtraBackup
(<a href="http://www.percona.com/doc/percona-xtrabackup/2.2/release-notes/2.2/2.2.10.html">2.2.10</a>)
breaks that feature with MariaDB 10.0. And it is not a bug, it is a feature.
Let me explain: it is due to an old feature that was not enabled.</p>

<p>Two years ago (exactly), XtraBackup got a feature called <a href="https://github.com/percona/percona-xtrabackup/commit/a37c7cbca557e94bb5f5ffe4ae02378dcf98daf7">bitmap-based incremental backups</a>. But that feature was (at least partly) not working, as that feature was always disabled. It was fixed <a href="https://github.com/percona/percona-xtrabackup/commit/a39237dd1a4de653e205e63b81ae5c4c5659116d">recently</a>.</p>

<p>The fix enables that feature in MariaDB 10.0. When an incremental backup is done,
XtraBackup issues the following command:</p>

<pre><code>::mysql
FLUSH NO_WRITE_TO_BINLOG CHANGED_PAGE_BITMAPS
</code></pre>

<p>Which does not exist in MariaDB:</p>

<pre><code>You have an error in your SQL syntax; check the manual that corresponds to
your MariaDB server version for the right syntax to use near
CHANGED_PAGE_BITMAPS.
</code></pre>

<p>There are two upstream bugs for this: <a href="https://bugs.launchpad.net/percona-xtrabackup/+bug/1444541">one for XtraBackup</a>
and <a href="https://mariadb.atlassian.net/browse/MDEV-7472">another one for MariaDB</a>.
It will probably not be fixed in MariaDB (at least not in a close future), but
we can reasonably expect that XtraBackup 2.2.11 will contain a fix for this.</p>

<h3 id="command-line-workaround">Command-line workaround</h3>

<p>The recommended workaround for MariaDB is to use the <code>--incremental-force-scan</code> option
as <a href="https://bugs.launchpad.net/percona-xtrabackup/+bug/1444541/comments/5">pointed out by Sergei Glushchenko</a>.</p>

<h3 id="patch-for-backward-compatibility">Patch for backward compatibility</h3>

<p>The following patch allows you to break the feature detection to have backward
command-line compatibility:</p>

<pre><code> ::diff
 --- a/bin/innobackupex  2015-04-15 18:07:06.472692735 +0200
 +++ b/bin/innobackupex  2015-04-15 18:07:52.092927798 +0200
 @@ -4981,10 +4981,7 @@
      my $con = shift;

      if ($option_incremental) {
 -        $have_changed_page_bitmaps =
 -            mysql_get_one_value($con, &quot;SELECT COUNT(*) FROM &quot; .
 -                        &quot;INFORMATION_SCHEMA.PLUGINS &quot; .
 -                        &quot;WHERE PLUGIN_NAME LIKE 'INNODB_CHANGED_PAGES'&quot;);
 +        $have_changed_page_bitmaps = 0;
      }

      if (!defined($con-&gt;{vars})) {
</code></pre>

<p>Please note that this patch is for the pre-compiled version of XtraBackup. In
the source tree, the file to patch is <code>storage/innobase/xtrabackup/innobackupex.pl</code>.</p>

<p>You should now be able to enjoy all the new changes of the latest version of
XtraBackup with MariaDB 10.0!</p>

</div>
<div class="message mb-3">
    <div class="bg-faded p-3 text-center">
        <a href="/blog/2015/04/15/xtrabackup-and-mariadb/">Permalink</a>. Category: Linux. Tags: mysql planet-inuits.<br/>
        First published on Wed 15 April 2015.
    </div>
</div>

        <hr class="mb-4 mt-4"/>
    
        <h1 class="title mt-3 mb-3"><a href="/blog/2015/03/26/css-update/" class="text-gray-dark">
    CSS update
</a></h1>
<div class="content text-justify">
    <p>As the <a href="https://yaml.de">YAML CSS</a> project looks like dead, I have changed the
design of my blog to <a href="https://primercss.io">Primer</a>, the CSS Framework made by
GitHub.</p>

<p>I hope that you will enjoy it, it should be more readable and easy to navigate. Everything should have been ported to that new design. I have removed openpgp.js because it was not used.</p>

<p>As a reminder I have a RSS feed that contains only my technical articles: the <a href="http://roidelapluie.be/feeds/planet-inuits.tag.atom.xml">planet-inuits</a> tag feed..</p>

</div>
<div class="message mb-3">
    <div class="bg-faded p-3 text-center">
        <a href="/blog/2015/03/26/css-update/">Permalink</a>. Category: Blog. Tags: pelican css.<br/>
        First published on Thu 26 March 2015.
    </div>
</div>

        <hr class="mb-4 mt-4"/>
    
        <h1 class="title mt-3 mb-3"><a href="/blog/2015/03/12/google-to-shut-down-google-code/" class="text-gray-dark">
    Google to shut down Google Code
</a></h1>
<div class="content text-justify">
    <p><a href="http://google-opensource.blogspot.be/2015/03/farewell-to-google-code.html">Google</a> is <a href="http://google-opensource.blogspot.be/2015/03/farewell-to-google-code.html">shutting down Google Code</a>. It was quite expected that it would join the Google graveyard. It was a cool service but the UI never got a lot of attention. Parsing a source tree or looking at issues was like traveling back in 2006.</p>

<p>This should however be a reminder that all of these platforms (Google Code, Github, Bitbucket) are centralized and closed-source. Even if Github loves Open-Source, and is loved by the Open-Source community, it is a totally closed platform.</p>

<p>Which alternatives do you have them if you want to self-host your repositories? A bunch of them actually. The most bling-bling one being <a href="https://about.gitlab.com/downloads/">Gitlab</a>. You also have Gitorious, Gitblit, Gitlist, &hellip; There are a huge number of them. There are even complete forges out there like <a href="http://codingteam.net/project/codingteam">CodingTeam</a>.</p>

<p>The real question is how to combine visibility and freedom? My guess is that will only be possible with self-hosted projects being mirrored on upstream sites. Your code continues to be free, and hosted in several places.</p>

<p>I personally use Github because there are a lot of people there. A project that is not on Github is even a python project or a dead project, in most of the cases. Sourceforge is only the place to download tarballs and Google Code was not really used anymore.</p>

<p>Long live GitHub, GitLab and every other alternative places where we will put our code and make it live. Long live git. And thanks Google Code.</p>

</div>
<div class="message mb-3">
    <div class="bg-faded p-3 text-center">
        <a href="/blog/2015/03/12/google-to-shut-down-google-code/">Permalink</a>. Category: Open-Source. Tags: code.<br/>
        First published on Thu 12 March 2015.
    </div>
</div>

        <hr class="mb-4 mt-4"/>
    
        <h1 class="title mt-3 mb-3"><a href="/blog/2014/12/09/puppet-server/" class="text-gray-dark">
    Puppet Server
</a></h1>
<div class="content text-justify">
    <p>I have tested <a href="https://github.com/puppetlabs/puppet-server">Puppet Server</a>, the
new puppet master implementation in Clojure. And I am quite happy.</p>

<p><strong>It just works</strong></p>

<p>The first amazing thing was that it did just work the same way as Puppetmaster.</p>

<p>I did not need to change any configuration file. Every custom function and module just worked like before.</p>

<p>I am using the <a href="https://github.com/theforeman/puppet-puppet">puppet-puppet</a> from <a href="https://theforeman.org">the Foreman</a>, which already have a <code>server_implementation</code> parameter. Switching it to <code>puppetserver</code> just did the trick.</p>

<p>I also needed to pass the <code>puppet_service_name</code> parameter to <code>puppetdb::master::config</code>:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> {
  <span style="color: #BA2121">&#39;::puppet&#39;</span>:
    <span style="color: #7D9029">server</span>                <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">true</span>,
    <span style="color: #7D9029">server_implementation</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;puppetserver&#39;</span>,
}

<span style="color: #008000; font-weight: bold">class</span> {
  <span style="color: #BA2121">&#39;::puppetdb::master::config&#39;</span>:
    <span style="color: #7D9029">puppet_service_name</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;puppetserver&#39;</span>,
}
</pre></div>

<p><strong>What&rsquo;s around also works</strong></p>

<p>Hiera was working out of the box, just like PuppetDB. Great efforts have been taken to ensure an easy transition.</p>

<p>There is no configuration changed needed at that level also.</p>

<p><strong>As expected, it is slow, then fast</strong></p>

<p>The startup time is really really bigger than the old <code>passenger+httpd</code> stack. It take a very long time to start.</p>

<p>But that was expected and once it is started it is really more efficient and catalogs get compiled in no time.</p>

<p>I did not experience any troubles concerning on-disk file changes. Changes to the <code>.pp</code> files were automatically picked up by the server.</p>

<p><strong>Batteries not included</strong></p>

<p>What makes me a bit sad is the fact that <a href="https://docs.puppetlabs.com/pe/latest/puppet_server_metrics.html">Puppet Server Metrics</a> are completely closed source. Yes you can get a lot of these metrics by using tools like <a href="https://collectd.org/wiki/index.php/Plugin:puppet_reports">collectd</a>, but having the server sending them directly to a graphite server would have been very nice.</p>

<p>That would also have helped the community to join the Puppet Server boat. But they took their decision and there is no sign that it will change in the short time.</p>

<p><strong>I still like it</strong></p>

<p>Even if I am disappointed as a Puppet contributor to see that Puppetlabs is not open-sourcing the metrics part of Puppet Server, I still like the idea of having a good replacement for <code>httpd+passenger</code>. Playing with passenger RPM&rsquo;s used to be a pain in the past, and having an apache server is not ideal. With Puppet Server we have a robust daemon that is efficient.</p>

<p>I hope that the community will jump in to chase the bugs and write a new chapter in the Puppet story.</p>

</div>
<div class="message mb-3">
    <div class="bg-faded p-3 text-center">
        <a href="/blog/2014/12/09/puppet-server/">Permalink</a>. Category: Automation. Tags: centos automation planet-inuits puppet.<br/>
        First published on Tue 9 December 2014.
    </div>
</div>

        <hr class="mb-4 mt-4"/>
    
        <h1 class="title mt-3 mb-3"><a href="/blog/2014/12/05/openldap-ca/" class="text-gray-dark">
    Importing a CA into OpenLDAP
</a></h1>
<div class="content text-justify">
    <p>Here is a quick how to about OpenLDAP under CentOS 6 and a custom Certificate Authority..</p>

<p>OpenLDAP in CentOS 6 is built with NSS to deal with ssl/tls.</p>

<p>When you try to securely connect to a LDAP host that, you will get the following errors:</p>

<pre><code>$ ldapsearch -H ldaps://172.28.5.5 -d -1
[...snip...]
TLS: certificate [CN=ldap.inuits.eu,OU=Infra,O=Inuits,ST=Antwerp,C=BE] is
not valid - error -8179:Peer's Certificate issuer is not recognized..
tls_write: want=7, written=7
  0000:  15 03 01 00 02
TLS: error: connect - force handshake failure: errno 0 -
moznss error -8179
TLS: can't connect: TLS error -8179:Peer's Certificate issuer is not
recognized..
ldap_msgfree
ldap_err2string
ldap_sasl_interactive_bind_s: Can't contact LDAP server (-1)
        additional info: TLS error -8179:Peer's Certificate issuer
        is not recognized.
</code></pre>

<p>The first step is to get you CA certificates. For this post, let&rsquo;s assume that the CA file is called <code>rootCA.crt</code>. In real life, you will get several certificates like that.</p>

<p>If the certificate is in DES we will first need to convert it into PEM. This is optional if the certificate is already in a PEM format.</p>

<pre><code>openssl x509 -text -in rootCA.crt -inform des -outform pem &gt; rootCA.pem
</code></pre>

<p>Once you have the certificat in PEM, you will need to compute the hash:</p>

<pre><code>::text
$ openssl x509 -in rootCA.pem -noout -hash
e6adf2fd
</code></pre>

<p>You will get a hash, e.g <code>e6adf2fd</code>.</p>

<p>Move the certificate to the right directory, with the name <code>${hash}.0</code>:</p>

<pre><code>mv rootCA.prm /etc/openldap/cacerts/e6adf2fd.0
</code></pre>

<p>When you will to your LDAP search again with -1, you should see that the certificate is shown:</p>

<pre><code>$ ldapsearch -H ldaps://172.28.5.5 -d -1
[...snip...]
TLS: loaded CA certificate file /etc/openldap/cacerts/e6adf2fd.0
from CA certificate directory /etc/openldap/cacerts.
[...snip...]
</code></pre>

<p>You can now safely use LDAPs with your own CA.</p>

</div>
<div class="message mb-3">
    <div class="bg-faded p-3 text-center">
        <a href="/blog/2014/12/05/openldap-ca/">Permalink</a>. Category: Linux. Tags: centos planet-inuits ldap.<br/>
        First published on Fri 5 December 2014.
    </div>
</div>

        <hr class="mb-4 mt-4"/>
    
    <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
            
            
            
            
            
            
            
            
            
            
            <li class="page-item ">
                <a class="page-link" href="/blog/page/7/" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            
            
            
            
            
            
            <li  class="page-item "><a class="page-link" href="/blog/">1</a></li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <li  class="page-item disabled"><a class="page-link">...</a></li>
            
            
            <li  class="page-item "><a class="page-link" href="/blog/page/7/">7</a></li>
            
            
            
            
            
            
            <li  class="page-item  active"><a class="page-link" href="/blog/page/8/">8</a></li>
            
            
            
            
            
            
            <li  class="page-item "><a class="page-link" href="/blog/page/9/">9</a></li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            <li  class="page-item disabled"><a class="page-link">...</a></li>
            
            
            <li  class="page-item "><a class="page-link" href="/blog/page/14/">14</a></li>
            
            
        <li class="page-item">
            <a class="page-link" href="/blog/page/9/" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
            </a>
        </li>
    </ul>
</nav>

        </div>
        </div>
        <footer class="pt-2">
            <div class="text-center p-5">
                <p>Content written by Julien Pivotto, licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a>.
</p>
                <p>Proudly generated by <a href="http://gohugo.io/">Hugo 0.25.1</a>, using <a href="http://getbootstrap.com/">Bootstrap</a> and <a href="http://pygments.org/">Pygments</a>.
</p>
                <p>This page has been generated on 2017-07-24.
</p>
            </div>
        </footer>
        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <script type="text/javascript" src="/js/jquery.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    </body>
</html>

