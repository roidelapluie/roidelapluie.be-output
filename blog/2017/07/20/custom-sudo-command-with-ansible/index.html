<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="Hugo 0.59.1" />

        <title>Custom Sudo command with Ansible - Julien Pivotto</title>
    </head>
    <body class="bg-faded">
        <nav class="navbar is-info">
    <div class="container">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            roidelapluie
        </a>
        <div class="navbar-burger" data-target="navMenu">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div class="navbar-menu" id="navMenu">
        
        <div class="navbar-start">
            
            
            <a class="navbar-item " href="/">
                        About me
                    </a>
                
                
            
            <a class="navbar-item  is-active" href="/blog/">
                        Blogs
                    </a>
                
                
            
            <a class="navbar-item " href="/exherbo/">
                        Exherbo
                    </a>
                
                
            
            <a class="navbar-item " href="/talk/">
                        Talks
                    </a>
                
                
            
            <a class="navbar-item " href="/wiki/">
                        Wikis
                    </a>
                
                
        </div>
        <div class="navbar-end">
                
                
                    
                    
                    <a class="navbar-item  is-active" href="/en">
                        en
                    </a>
                
                
                    
                    
                    <a class="navbar-item " href="/fr">
                        fr
                    </a>
                
        </div>
    </div>
    </div>
</nav>


<section class="hero is-primary">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
                Blog
            </h1>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
<h1 class="title"><a href="/blog/2017/07/20/custom-sudo-command-with-ansible/" class="text-gray-dark">
    Custom Sudo command with Ansible
</a></h1>
<div class="content text-justify">
    <p>While introducing <a href="https://www.ansible.com/">Ansible</a> at customer, I noticed the
following problem while using ansible <code>become</code> feature:</p>

<pre><code>sudo: unable to create /var/log/sudo-io/170718-124212: File exists
sudo: error initializing I/O plugin sudoers_io
</code></pre>

<p>That was because in the sudoers configuration, you have:</p>

<pre><code>Defaults syslog=auth,log_input,log_output,iolog_file=%y%m%d-%H%M%S
</code></pre>

<p>Which means that sudo sessions will be logged, but there can only be one sudo
session per second. While discussing with colleagues what would be the best way
to address this &ndash; several options are possible: not logging, logging with seq
(<code>Defaults:ansible iolog_file=ansible/%{seq}</code>), logging microseconds, &hellip; &ndash; I
have implemented a workaround.</p>

<p>What is interesting is that it uses an undocumented feature: <code>become_exe</code>.</p>

<p>I dropped a file in the ansible repo with the following content:</p>

<pre><code>[privilege_escalation]
become_exe = /bin/sleep 1 &amp;&amp; /bin/sudo
</code></pre>

<p>And, magically, ansible now waits one second between sudo commands. Enough to
let me continue working while looking for the best resolution.</p>

</div>
<div class="message">
    <div class="message-body has-text-centered">
        <a href="/blog/2017/07/20/custom-sudo-command-with-ansible/">Permalink</a>. Category: automation. Tags: linux security ansible planet-inuits.<br/>
        First published on Thu 20 July 2017.
    </div>
</div>

    </div>
</section>
        <footer class="footer">
            <div class="container">
            <div class="content has-text-centered">
                <p>Content written by Julien Pivotto, licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a>. Conference logos are property of their owners are used here as fair use.
</p>
                <p>Proudly generated by <a href="http://gohugo.io/">Hugo 0.59.1</a>, using <a href="http://bulma.io/">Bulma</a>, <a href="https://github.com/twitter/twemoji">Twemoji</a> (licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>) and <a href="http://pygments.org/">Pygments</a>.
</p>
                <p>This page has been generated on 2021-05-02.
</p>
            </div>
            </div>
        </footer>
        <link rel="stylesheet" href="/css/bulma.css">
        <link rel="stylesheet" href="/css/twemoji.css">
        <script type="text/javascript" src="/js/bulma.js"></script>
        <script type="text/javascript" src="/js/twemoji.min.js"></script>
        <script type="text/javascript">
twemoji.parse(document.body);
        </script>
    </body>
</html>

