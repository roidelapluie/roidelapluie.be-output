<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="Hugo 0.25.1" />

        <title>Custom Sudo command with Ansible - Julien Pivotto</title>
    </head>
    <body class="bg-faded">
        <div class="bg-primary"><nav class="navbar navbar-toggleable-md navbar-inverse bg-primary container">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-brand mb-0">roidelapluie</div>
        
        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav mr-auto">
                
                
                <a class="nav-item nav-link " href="/">
                        About me
                    </a>
                
                
                
                <a class="nav-item nav-link  active" href="/blog/">
                        Blogs
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/exherbo/">
                        Exherbo
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/logbook/">
                        Logbooks
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/skill/">
                        Skills
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/talk/">
                        Talks
                    </a>
                
                
                
                <a class="nav-item nav-link " href="/wiki/">
                        Wikis
                    </a>
                
                
            </div>
            <div class="navbar-nav">
                
                
                    
                    
                    <a class="nav-item nav-link  active" href="/en">
                        en
                    </a>
                
                
                    
                    
                    <a class="nav-item nav-link " href="/fr">
                        fr
                    </a>
                
            </div>
        </div>
</nav>
</div>

        <div style="background-color:white">
        <div class="container pt-3 pb-3">

<h1 class="title mt-3 mb-3"><a href="/blog/2017/07/20/custom-sudo-command-with-ansible/" class="text-gray-dark">
    Custom Sudo command with Ansible
</a></h1>
<div class="content text-justify">
    <p>While introducing <a href="https://www.ansible.com/">Ansible</a> at customer, I noticed the
following problem while using ansible <code>become</code> feature:</p>

<pre><code>sudo: unable to create /var/log/sudo-io/170718-124212: File exists
sudo: error initializing I/O plugin sudoers_io
</code></pre>

<p>That was because in the sudoers configuration, you have:</p>

<pre><code>Defaults syslog=auth,log_input,log_output,iolog_file=%y%m%d-%H%M%S
</code></pre>

<p>Which means that sudo sessions will be logged, but there can only be one sudo
session per second. While discussing with colleagues what would be the best way
to address this &ndash; several options are possible: not logging, logging with seq
(<code>Defaults:ansible iolog_file=ansible/%{seq}</code>), logging microseconds, &hellip; &ndash; I
have implemented a workaround.</p>

<p>What is interesting is that it uses an undocumented feature: <code>become_exe</code>.</p>

<p>I dropped a file in the ansible repo with the following content:</p>

<pre><code>[privilege_escalation]
become_exe = /bin/sleep 1 &amp;&amp; /bin/sudo
</code></pre>

<p>And, magically, ansible now waits one second between sudo commands. Enough to
let me continue working while looking for the best resolution.</p>

</div>
<div class="message mb-3">
    <div class="bg-faded p-3 text-center">
        <a href="/blog/2017/07/20/custom-sudo-command-with-ansible/">Permalink</a>. Category: automation. Tags: linux security ansible planet-inuits.<br/>
        First published on Thu 20 July 2017.
    </div>
</div>

        </div>
        </div>
        <footer class="pt-2">
            <div class="text-center p-5">
                <p>Content written by Julien Pivotto, licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a>.
</p>
                <p>Proudly generated by <a href="http://gohugo.io/">Hugo 0.25.1</a>, using <a href="http://getbootstrap.com/">Bootstrap</a> and <a href="http://pygments.org/">Pygments</a>.
</p>
                <p>This page has been generated on 2017-07-24.
</p>
            </div>
        </footer>
        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <script type="text/javascript" src="/js/jquery.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    </body>
</html>

